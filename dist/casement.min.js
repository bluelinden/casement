/*! For license information please see casement.min.js.LICENSE.txt */
!function(e,a){"object"==typeof exports&&"object"==typeof module?module.exports=a():"function"==typeof define&&define.amd?define([],a):"object"==typeof exports?exports.casement=a():e.casement=a()}(self,(()=>(()=>{"use strict";var e={d:(a,s)=>{for(var t in s)e.o(s,t)&&!e.o(a,t)&&Object.defineProperty(a,t,{enumerable:!0,get:s[t]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},a={};e.r(a),e.d(a,{Inside:()=>t,Outside:()=>n});class s{constructor(){this.name="default",this.allowedDomain=""}}class t extends s{init(){window.addEventListener("message",(e=>{this.handleIncoming})),window.parent.postMessage({type:`casement-${this.name}-inside-ready`})}send(e,a){this.allowSend?(a||(a="casement-message"),window.parent.postMessage({type:"casement-outside-message",message:e,actionName:a},this.allowedDomain)):console.warn("Casement Error: Cannot send message. The iFrame has not yet loaded, or has not yet confirmed that it is ready.")}on(e,a){this.onMessage||(this.onMessage=[]),this.onMessage.push({name:e,callback:a})}request(e,a){if(this.allowSend)return new Promise((s=>{window.parent.postMessage({type:`casement-${this.name}-inside-request`,transmissionID:Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),message:e,actionName:a},this.allowedDomain);const t=a=>{a.origin===this.allowedDomain&&a.data.type===`casement-${this.name}-inside-response`&&a.data.transmissionID===e.transmissionID&&(window.removeEventListener("message",t),s(a.data.message))};window.addEventListener("message",t)}));console.warn("Casement Error: Cannot send message. The outside window has not yet confirmed that it is ready. Make sure the outside window is properly able to send messages to this window.")}handleIncoming(e){if(e.origin===this.allowedDomain)switch(e.data.type){case`casement-${this.name}-outside-ready`:this.allowSend=!0,this.onReady&&this.onReady();break;case`casement-${this.name}-outside-message`&&e.data.actionName:this.onMessage?this.onMessage.forEach((a=>{a.name===e.data.actionName?a.callback(e.data.message):"*"===a.name&&a.callback(e.data.message,e.data.actionName)})):console.warn("Casement Error: Received a message from outside but no handler was set. Make sure to use the inside.on() method to set a handler for this request.");break;case`casement-${this.name}-inside-request`:this.onMessage?window.parent.postMessage({type:`casement-${this.name}-inside-response`,message:Promise.all(this.onMessage.map((a=>a.name===e.data.actionName?a.callback(e.data.message):"*"===a.name?a.callback(e.data.message,e.data.actionName):void 0)))},this.allowedDomain):console.warn("Casement Error: Received a request from outside but no handler was set. Make sure to use the inside.on() method to set a handler for this request.");break;case`casement-${this.name}-outside-ready`:this.allowSend=!0,this.onReady&&this.onReady()}}kill(e=!1){e&&this.onKill&&this.onKill(),window.parent.postMessage({type:`casement-${this.name}-inside-kill-ready`})}constructor(e){super(),this.allowSend=!1,this.name=e.name,this.allowedDomain=e.allowedDomain,e.onReady&&(this.onReady=e.onReady),this.init()}}class n extends s{init(){window.addEventListener("message",(e=>{this.handleIncoming}))}send(e,a){this.allowSend?(a||(a="casement-message"),this.iFrame.contentWindow.postMessage({type:"casement-outside-message",message:e,actionName:a},this.allowedDomain)):console.warn("Casement Error: Cannot send message. The iFrame has not yet loaded, or has not yet confirmed that it is ready.")}on(e,a){this.onMessage||(this.onMessage=[]),this.onMessage.push({name:e,callback:a})}request(e,a){if(this.allowSend)return new Promise((s=>{this.iFrame.contentWindow.postMessage({type:`casement-${this.name}-outside-request`,transmissionID:Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),message:e,actionName:a},this.allowedDomain);const t=a=>{a.origin===this.allowedDomain&&a.data.type===`casement-${this.name}-inside-response`&&a.data.transmissionID===e.transmissionID&&(window.removeEventListener("message",t),s(a.data.message))};window.addEventListener("message",t)}));console.warn("Casement Error: Cannot send message. The iFrame has not yet loaded, or has not yet confirmed that it is ready.")}handleIncoming(e){if(e.origin===this.allowedDomain)switch(e.data.type){case`casement-${this.name}-inside-ready`:this.allowSend=!0,this.iFrame.contentWindow.postMessage({type:`casement-${this.name}-outside-ready`},this.allowedDomain),this.onReady&&this.onReady();break;case`casement-${this.name}-inside-message`&&e.data.actionName:this.onMessage?this.onMessage.forEach((a=>{a.name===e.data.actionName?a.callback(e.data.message):"*"===a.name&&a.callback(e.data.message,e.data.actionName)})):console.warn('Casement Error: Received a message from inside but no handler was set. Remember to pass a handler function to the "onMessage" option when creating a new casement.Outside instance.');break;case`casement-${this.name}-inside-request`:this.onMessage?this.iFrame.contentWindow.postMessage({type:`casement-${this.name}-outside-response`,message:Promise.all(this.onMessage.map((a=>a.name===e.data.actionName?a.callback(e.data.message):"*"===a.name?a.callback(e.data.message,e.data.actionName):void 0)))},this.allowedDomain):console.warn('Casement Error: Received a request from inside but no handler was set. Remember to pass a handler function to the "onMessage" option when creating a new casement.Outside instance.')}}kill(e=!1){this.onKill&&this.onKill(),this.iFrame.contentWindow.postMessage({type:"casement-outside-kill"},this.allowedDomain);const a=e=>{e.origin===this.allowedDomain&&e.data.type===`casement-inside-${this.name}-kill-ready`&&(this.iFrame.remove(),window.removeEventListener("message",a))};e?e&&this.iFrame.remove():window.addEventListener("message",a)}constructor(e){super(),this.allowSend=!1,this.name=e.name,this.pageUrl=e.pageUrl||"/",this.allowedDomain=this.pageUrl.split("/").slice(0,3).join("/"),e.onReady&&(this.onReady=e.onReady),e.container?(this.container=e.container,this.iFrame=document.createElement("iframe"),this.iFrame.src=this.pageUrl,this.container.appendChild(this.iFrame)):e.iFrame&&(this.iFrame=e.iFrame),this.init()}}return a})()));